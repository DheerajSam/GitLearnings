<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
        <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>

        <title>Local Storage</title>
    </head>
    
    <body>
        <form onsubmit="addToLocalStorage(event)">
            <div class="container">
                <header class="mb-5"><h1>Add User Details To Local Storage</h1></header>
                      
                <label class="form-label">User Name:</label>        
                <input id="user" type="text" class="form-control" required/>

                <label class="form-label">Email:</label>        
                <input id="email" type="text" class="form-control" required/>

                <label class="form-label">Mobile No:</label>        
                <input id="phone" type="text" class="form-control"/><br> 

                <button class="btn-secondary btn">Submit</button><br><br>
                
            </div> 
        </form>    
        
        <ul id="listOfusers">
            <!-- <button class="button">Delete</button> -->
        </ul>
        
        <script>
            function addToLocalStorage(event){
                event.preventDefault();
                let name = document.getElementById('user').value;
                let email = document.getElementById('email').value;
                let mobile  = document.getElementById('phone').value;
                // localStorage.setItem('User Name', name);
                // localStorage.setItem('Email',email);
                // localStorage.setItem('Mobile',mobile);
                
                let obj = {
                    name,
                    email,
                    mobile                
                };

                //store multiple user data in local storage taking the key as Email which is unique
                localStorage.setItem(obj.email,JSON.stringify(obj));

                //show the user details on the screen as a list using DOM manipulation
                showUserOnScreen(obj);
            }

            
            // function showOnscreen(obj){
            //     let parentElem = document.getElementById('listOfusers');
            //     let childElem = document.createElement('li');
            //     childElem.textContent = obj.name +', '+ obj.email +', '+ obj.mobile +' ';
            //     parentElem.appendChild(childElem);

            //     //Delete event
            //     parentElem.addEventListener('click', ondelete);

            //     parentElem.addEventListener('click', onclick);

            //     //create del button element
            //     let delBtn = document.createElement('button');
            //     delBtn.className = 'btn btn-danger btn-sm float-right delete';

            //     let editBtn = document.createElement('button');
            //     editBtn.className = 'btn btn-primary btn-sm float-right edit';

            //     //Delete User Data from Screen and Local Storage
            //     function ondelete(e){                
            //         if(e.target.classList.contains('delete')){                    
            //             let li = e.target.parentElem;                         
            //             localStorage.removeItem(obj.email); 
            //             parentElem.removeChild(li);                  
            //         }
            //     }

            //     //Edit User Data from Screen 
            //         function onclick(event){                
            //         if(event.target.classList.contains('edit')){                    
                                                  
            //             localStorage.removeItem(obj.email); 
            //             parentElem.removeChild(childElem)
                          
                        
            //             document.getElementById('user').value = obj.name;
            //             document.getElementById('email').value = obj.email;
            //             document.getElementById('phone').value = obj.mobile;

            //         }
            //     }

            //     //Append text node
            //     delBtn.appendChild(document.createTextNode('Delete'));
            //     editBtn.appendChild(document.createTextNode('Edit'));

            //     //Append Delete and Edit buttons to li
            //     childElem.appendChild(delBtn);
            //     childElem.appendChild(editBtn);
            //     parentElem.appendChild(childElem)
                
            // }       

            function showUserOnScreen(obj){
                    let parentElem = document.getElementById('listOfusers');
                    let childElem = document.createElement('li');
                    childElem.textContent = obj.name +', '+ obj.email +', '+ obj.mobile +' ';
                    parentElem.appendChild(childElem);

                    //Delete event
                    parentElem.addEventListener('click', onclick);
                    parentElem.addEventListener('click', onclick);

                    //Create Delete Button
                    let delBtn = document.createElement('input');
                    delBtn.type = "button";
                    delBtn.value = "X";
                    delBtn.className = 'btn btn-danger btn-sm float-right delete';

                    //Delete Function
                    delBtn.onclick = () => {
                        localStorage.removeItem(obj.email); //removes user from localStorage
                        parentElem.removeChild(childElem);  //removes user details on screen
                    }

                    //Create Edit Button
                    let editBtn = document.createElement('input');
                    editBtn.type = "button";
                    editBtn.value = "Edit";
                    editBtn.className = 'btn btn-primary btn-sm float-right edit';

                    //Edit Function
                    editBtn.onclick = () => {

                        localStorage.removeItem(obj.email);
                        parentElem.removeChild(childElem);

                        //populate user details that needs to be edited in the
                        document.getElementById('user').value = obj.name;
                        document.getElementById('email').value = obj.email;
                        document.getElementById('phone').value = obj.mobile;
                    }

                    //Append Delete and Edit buttons to li
                    childElem.appendChild(delBtn);
                    childElem.appendChild(editBtn);
                    parentElem.appendChild(childElem);
            }
            
        </script>
        
    </body>
</html>
